---
draw:
tags: []
title: 抓取
date created: 2024-12-22
date modified: 2024-12-27
---

在实际开发或学习场景中，如果想要下载（抓取）网页中的视频，一般会经历以下几个步骤。**请务必先确认自己对视频有下载、存储或使用的合法权限**，再进行以下操作。

---

## 1. 分析网页请求，找到视频真实地址

1. **打开开发者工具**  
    在浏览器（Chrome、Edge 等）中，按 `F12` 或者右键 → "检查"，打开开发者工具，切换到 **Network（网络）** 面板。
    
2. **开始播放视频，观察 Network 面板请求**
    
    - 让视频正常播放或刷新页面，以便加载播放所需的网络请求。
    - 通常会看到一些请求后缀为 `.mp4` 或者 `.m3u8`，有些情况下会看到多段 `.ts` 文件（HLS 切片），也可能有加密流等等。
    - 如果比较幸运，能直接看到一个 `.mp4` 链接，并且这个链接在地址栏中可以直接访问，那么就是视频的原始地址。
3. **右键复制请求**
    
    - 如果找到了符合视频文件格式（mp4/m3u8/ts 等）的请求，通常可以右键点击该请求，在弹出菜单中选择"Copy as cURL"或者"Copy link address"（不同浏览器的提示略有差异）。
    - 复制得到的链接或 cURL 命令可以用来后续下载。

> **小提示**：
>
> - 如果用的是 HLS（.m3u8）切片视频，那就需要先找到 `.m3u8` 的主文件链接，然后配合工具（如 ffmpeg、`youtube-dl` / `yt-dlp` 等）来整合下载。
> - 如果整个流程被网站加了特殊的加密或授权机制，可能就需要进一步分析加密方式。通常课程类网站为了版权保护，会对视频做加密，下载难度会加大。

---

## 2. 选择适合的下载方式或工具

### 2.1 使用 ffmpeg 下载（适合 m3u8/HLS 等流式视频）

如果在 Network 面板里找到了一个 `.m3u8` 文件链接，可以使用 [ffmpeg](https://ffmpeg.org/) 下载：

bash

Copy code

`ffmpeg -i "https://example.com/path/to/playlist.m3u8" -c copy output.mp4`

- `-i` 后面跟的是你在 Network 面板看到的 `.m3u8` 文件地址。
- `-c copy` 表示不经过重新编码，直接复制流。

### 2.2 使用 `youtube-dl` 或改进版 `yt-dlp`

`youtube-dl` 和 `yt-dlp` 都支持从许多网站直接下载视频（包括.mp4、.m3u8 等），用起来也相对简单。

bash

Copy code

`# 以 yt-dlp 为例 yt-dlp "https://example.com/path/to/video.mp4"`

如果是 m3u8 流，也能直接写：

bash

Copy code

`yt-dlp "https://example.com/path/to/playlist.m3u8"`

它会自动解析并合并切片。

### 2.3 使用 Python 手动抓取并合并

如果你想自己用 Python 写脚本，示例思路如下：

1. **确定视频文件 URL 或者 m3u8**  
    先从 Network 面板拿到 `.mp4` 或者 `.m3u8` 地址。
    
2. **发送请求下载**
    
    - 对于直接的 `.mp4` 文件，可以使用 `requests` 库流式下载，边下载边写入到本地文件：
        

        python

        

        Copy code

        

        `import requests  url = "https://example.com/path/to/video.mp4" filename = "video.mp4"  with requests.get(url, stream=True) as r:     r.raise_for_status()     with open(filename, 'wb') as f:         for chunk in r.iter_content(chunk_size=8192):             if chunk:                 f.write(chunk)`

        
    - 如果是 `.m3u8`，则需要：
        1. 下载 `.m3u8` 文件，解析出所有 `.ts` 分段的 URL。
        2. 一一下载每段 `.ts`，并在本地顺序合并。
        3. 如果有加密，还要处理解密步骤（需要密钥和解密算法）。
3. **合并分片（如 m3u8 的.ts）**  
    简单做法是，把所有 `.ts` 文件用二进制形式顺次拼接起来，再用 `ffmpeg` 或者 `mp4box` 等工具将其封装为 MP4 格式，或者直接使用 ffmpeg 做一步到位的拉流-合并。
    

---

## 3. 常见问题与可能的坑

1. **权限与版权问题**
    
    - 课程类网站为了保护版权，经常会用到各种加密或限流，你要先确保自己有授权。
    - 在实际生产环境中，未经授权的下载可能触碰法律风险，需要格外谨慎。
2. **反爬策略和限速**
    
    - 有些平台对频繁请求会做封禁，可以考虑加一些延时或分段下载。
    - 如果遇到加密或 token 验证，需要进一步分析请求中的 header（如 cookies、authorization token 等）。
3. **m3u8 分段加密**
    
    - 可能需要先获得密钥（key），然后才能解密 `.ts` 分段。
    - 若 key 是临时从服务器获取的，脚本需要模拟登录或保持会话状态。

---

## 4. 综合建议

1. **先用浏览器开发者工具定位视频真实地址**（尤其是 m3u8 或 mp4）。
2. **尽量选择现成工具**（ffmpeg、yt-dlp等）来下载并合并，减少踩坑。
3. **若要通过纯 Python 手写代码**，则要注意处理分段下载、加密解密、合并转码等流程。
4. **留意版权与合法性**，要保证自己具备下载和使用该视频的权限。

---

如果这是老师给的实际**练习**，大概率是为了让大家学会利用浏览器开发者工具，以及熟悉脚本编程来进行**网络请求分析**与**自动化下载**。做好这几步，就能完成大部分基础要求了。祝学习顺利!

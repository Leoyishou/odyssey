---
date created: 2025-04-16
date modified: 2025-07-10
uid: d2c59329-438b-4509-afcb-772862a99b8c
---
1. æŒä¹…åŒ–ä¸å›æ”¾Â (CheckpointerÂ &Â Resume) é€šè¿‡ **Checkpointer** å¯æŠŠæ‰§è¡ŒçŠ¶æ€å†™å…¥æ–‡ä»¶ / DBï¼Œæ„å¤–ä¸­æ–­åç»§ç»­æ‰§è¡Œã€‚
2. æ¡ä»¶åˆ†æ”¯ã€åŠ¨æ€è·¯ç”± **ç†è®ºä»‹ç»**  graph.add_conditional_edges(node, fn)` å…è®¸æ ¹æ®â€¯fnâ€¯è¿”å›çš„æ ‡ç­¾åŠ¨æ€è·¯ç”±ã€‚å¸¸ç”¨æ¨¡å¼ï¼š**Routerâ€¯Node**ã€‚
3. çŠ¶æ€ç®¡ç†ã€å…±äº«ä¸Šä¸‹æ–‡  state

![CleanShot 2025-04-16 at 23.58.52@2x.png|1000](https://imagehosting4picgo.oss-cn-beijing.aliyuncs.com/imagehosting/fix-dir%2Fmedia%2Fmedia_Ks1xGMBeXd%2F2025%2F04%2F16%2F23-59-17-0dd536cf395767f2b253a5bba5654551-CleanShot%202025-04-16%20at%2023.58.52-2x-fd572c.png)

https://langchain-ai.github.io/langgraph/llms-txt-overview AI æ—¶ä»£çš„æ–‡æ¡£

## Pythonç‰ˆæœ¬LangGraphæ›´æ–°å†å²

| ç‰ˆæœ¬å·    | å‘å¸ƒæ—¥æœŸ       | ä¸»è¦æ›´æ–°å†…å®¹                                                                   |
| ------ | ---------- | ------------------------------------------------------------------------ |
| 0.1.0  | 2024å¹´10æœˆ   | ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬å‘å¸ƒï¼Œç¡®ç«‹äº†LangGraphä½œä¸ºç‹¬ç«‹äºä¸»LangChainåŒ…çš„æ¡†æ¶ï¼Œæ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯å¸®åŠ©å¼€å‘è€…åœ¨ä»£ç†å·¥ä½œæµä¸­å¢åŠ æ›´å¥½çš„ç²¾ç¡®æ€§å’Œæ§åˆ¶ |
| 0.3.0  | 2025å¹´2æœˆ26æ—¥ | è¢«æ’¤å›(yanked)çš„ç‰ˆæœ¬ï¼ŒåŸå› æ˜¯ç¼ºå°‘å¯¹langgraph-prebuiltçš„ä¾èµ–                               |
| 0.3.1  | 2025å¹´2æœˆ27æ—¥ | ä¿®å¤0.3.0ä¸­çš„ä¾èµ–é—®é¢˜                                                            |
| 0.3.5  | 2025å¹´3æœˆ5æ—¥  | åŠŸèƒ½å¢å¼ºä¸bugä¿®å¤                                                               |
| 0.3.10 | 2025å¹´3æœˆ14æ—¥ | æ¡†æ¶ç¨³å®šæ€§æå‡                                                                  |
| 0.3.15 | 2025å¹´3æœˆ18æ—¥ | åŠŸèƒ½å¢å¼ºä¸æ€§èƒ½ä¼˜åŒ–                                                                |
| 0.3.20 | 2025å¹´3æœˆ25æ—¥ | æ¡†æ¶åŠŸèƒ½æ‰©å±•                                                                   |
| 0.3.25 | 2025å¹´4æœˆ3æ—¥  | æå‡GraphInterruptåœ¨å­å›¾ä¸­çš„ä½¿ç”¨                                                  |
| 0.3.26 | 2025å¹´4æœˆ8æ—¥  | æ€§èƒ½ä¼˜åŒ–ä¸bugä¿®å¤                                                               |
| 0.3.28 | 2025å¹´4æœˆ11æ—¥ | å…è®¸ä¼ é€’é‡è¯•ç­–ç•¥åˆ—è¡¨                                                               |
| 0.3.30 | 2025å¹´4æœˆ14æ—¥ | å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼Œç¨³å®šæ€§ä¸åŠŸèƒ½æ›´æ–°                                                          |

## LangGraphå¹³å°

|éƒ¨ç½²é€‰é¡¹|ç‰¹ç‚¹|
|---|---|
|Self-Hosted Lite|å…è´¹ç‰ˆ(æ‰§è¡ŒèŠ‚ç‚¹æ•°é‡ä¸è¶…è¿‡1M)ï¼Œæœ‰é™åŠŸèƒ½ç‰ˆæœ¬çš„LangGraphå¹³å°ï¼Œå¯åœ¨æœ¬åœ°æˆ–è‡ªæ‰˜ç®¡æ–¹å¼è¿è¡Œ|
|Cloud SaaS|ä½œä¸ºLangSmithçš„ä¸€éƒ¨åˆ†å®Œå…¨æ‰˜ç®¡å’Œæ‰˜ç®¡ï¼Œè‡ªåŠ¨æ›´æ–°å’Œé›¶ç»´æŠ¤|
|Bring Your Own Cloud (BYOC)|åœ¨æ‚¨çš„VPCå†…éƒ¨ç½²LangGraphå¹³å°ï¼Œä½œä¸ºæœåŠ¡æä¾›å’Œè¿è¡Œ|
|Self-Hosted Enterprise|å®Œå…¨åœ¨æ‚¨è‡ªå·±çš„åŸºç¡€è®¾æ–½ä¸Šéƒ¨ç½²LangGraph|

## æ ¸å¿ƒæ¦‚å¿µ

| concept |     | è§£é‡Š                             |
| ------- | --- | ------------------------------ |
| node    |     | [[è´£ä»»é“¾æ¨¡å¼]]ä¸­çš„ processor          |
| state   |     | ç±»ä¼¼è´£ä»»é“¾æ¨¡å¼ä¸­çš„ contextï¼Œä¸€ä¸ªä¸æ–­æµä¼ çš„å…±äº«è®°äº‹æœ¬ |
| Edge    |     | å®šä¹‰ node ä¹‹é—´çš„é¡ºåºï¼Œåœ¨è´£ä»»é“¾æ¨¡å¼ä¸­å°±æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨  |

ä¸‹é¢è¿™å¼  **LangGraph é«˜é¢‘ APIÂ CheatÂ Sheet** æ€»ç»“äº†åœ¨æ—¥å¸¸æ­å»ºÂ StateGraph/AgentÂ å·¥ä½œæµæ—¶æœ€å¸¸ç”¨ã€æœ€æ˜“æ··æ·†çš„æ ¸å¿ƒæ¥å£ä¸å·¥å…·ã€‚æ‰€æœ‰åç§°éƒ½æŒ‰ã€Œ**åˆ›å»º â†’ æ‰§è¡Œ â†’ ç»´æŠ¤**ã€çš„å…¸å‹æ­¥éª¤ç¼–æ’ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥é˜…ã€‚

### LLMæ¥å…¥

```Java
from langchain_openai import ChatOpenAI
from langchain_deepseek import ChatDeepSeek
```

## ToolNode ä¸ Command

- **æµç¨‹ç®€å•ã€é‡ç‚¹åœ¨è‡ªåŠ¨â€œé€‰å·¥å…·â€** â†’ Toolâ€‘Calling é£æ ¼å³å¯ï¼Œä»£ç æœ€å°‘ã€‚
- **éœ€è¦å¤æ‚çŠ¶æ€æœºã€å¾ªç¯ã€å¹¶è¡Œ** â†’ ç”¨ `Command / goto` æˆ– `conditional_edges` æ›´ç›´è§‚ã€‚
- **éœ€è¦å…¼é¡¾** â†’ ä¸¤è€…æ··æ­ï¼š
    1. å‰æ®µç”¨ `ToolNode` è®©æ¨¡å‹â€œæƒ³å¹²å•¥å°±å«å•¥â€ï¼›
    2. å·¥å…·å†…éƒ¨æˆ–åæ®µèŠ‚ç‚¹ï¼Œå†è¿”å› `Command(...)` è¿›å…¥ä¸¥æ ¼æ§åˆ¶åŒºã€‚


## State

[[MessageStateã€AgentState]]

### Node

[[nodeã€agent]]

### Edge

| *Edge*                                       | *ç¡¬ç¼–ç è·³è½¬ã€å°‘åˆ†æ”¯*                                                                          |
| -------------------------------------------- |:----------------------------------------------------------------------------------- |
| å›ºå®šé¡ºåºè·³è½¬ï¼ˆçº¿æ€§å·¥ä½œæµï¼‰ã€‚| `graph_builder.add_edge("tools", "chatbot")`                                         |
| æ¡ä»¶åˆ†æ”¯è·¯ç”±ï¼›`cond_fn` è¿”å›ä¸‹ä¸€èŠ‚ç‚¹åæˆ–Â ENDã€‚| `graph_builder.add_conditional_edges("chatbot", tools_condition)`                    |
| é¢„æ„å»ºæ¡ä»¶å‡½æ•°ï¼šå¦‚æ¶ˆæ¯åŒ…å«Â tool_calls â†’ `"tools"`ï¼›å¦åˆ™Â ENDã€‚| `graph.add_conditional_edges("chatbot", tools_condition)`                            |
| *Command*                                    | *prompt+goto çµæ´»è·³è½¬  å¤šæ™ºèƒ½ä½“ã€Humanâ€‘inâ€‘theâ€‘Loopã€å¼‚å¸¸å…œåº•*                                      |
| Command = è·³ä¸‹ä¸€ä¸ª node + æ›´æ–° state               | return Command(<br>        update={"report": report},<br>        goto="__end__"<br>) |
| **æ‰¹é‡ä¿®æ”¹Â State**ï¼Œå« `messages` æˆ–ä»»æ„è‡ªå®šä¹‰é”®          | {"messages":[ToolMessage(...)], "step":"done"}                                       |
| **è·³è½¬ä¸‹ä¸€èŠ‚ç‚¹**ï¼›è¦†ç›– Edge è·¯ç”±                        | `return Command(goto="__end__")`                                                     |
| **æºå¸¦äººç±»è¾“å…¥** æ¢å¤ `interrupt` æš‚åœ                 | `return Command(resume=human)  `                                                     |

### æ‰§è¡Œ

[[graph æ‰§è¡Œ]]

[[memory]]

| ä½œç”¨ & å…¸å‹åœºæ™¯                          | å¸¸è§å…³é”®å‚æ•° / æœ€å°ç¤ºä¾‹                                                                                                                                                                         |                                             |
| ---------------------------------- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |:------------------------------------------ |
| åˆ›å»ºâ€œçŠ¶æ€é©±åŠ¨â€æœ‰å‘å›¾çš„å…¥å£ç±»ï¼›æ¯ä¸ªèŠ‚ç‚¹è¯»å†™åŒä¸€ä»½Â Stateã€‚| `graph_builder = StateGraph(State)`                                                                                                                                                   | âœ…                                           |
|                                    |                                                                                                                                                                                       | âœ…                                           |
| å‘å›¾ä¸­æ³¨å†ŒèŠ‚ç‚¹ï¼ˆå¯ä¸ºå‡½æ•°ã€LCÂ Runnableã€å­å›¾_ï¼‰ã€‚| `graph_builder.add_node("chatbot", chatbot_fn)`                                                                                                                                       | âœ…                                           |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       | å¼€æ”¾å¼çš„chat ä¼¼ä¹ä¸èƒ½æœ‰è¿™ç§ interruptï¼Œå¿…é¡»éƒ½ç»è¿‡ coordinate |
| è·¨å›¾å¯¼èˆªï¼š`Command.PARENT`Â å›åˆ°çˆ¶å›¾         | return Command(<br>        update={"score": 0.92},<br>        goto="reviewer",<br>        graph=Command.PARENT<br>)                                                                   |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
| æ„å»ºå¯æ‰§è¡Œå›¾ï¼›å¯ç»‘å®šæŒä¹…åŒ–æ–¹æ¡ˆã€‚| `graph = graph_builder.compile(checkpointer=MemorySaver())`                                                                                                                           |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
| CheckpointÂ åç«¯ï¼›è®©å›¾åœ¨å¤šè½®å¯¹è¯æˆ–å´©æºƒåâ€œæ–­ç‚¹ç»­è·‘â€ã€‚| `graph = graph.compile(checkpointer=MemorySaver())`                                                                                                                                   |                                             |
| é€äº‹ä»¶/é€å€¼æ‰§è¡Œï¼›é€‚åˆ CLIã€WebSocket æµå¼è¾“å‡ºã€‚| `for ev in graph.stream({'messages':[...]}, cfg):...`                                                                                                                                 |                                             |
|                                    |                                                                                                                                                                                       |                                             |
|                                    |                                                                                                                                                                                       |                                             |
| æŸ¥è¯¢æœ€æ–° / å…¨å†å² checkpointï¼Œæ”¯æŒâ€œæ—¶é—´æ—…è¡Œâ€ä¸åˆ†æ”¯ã€‚| `snapshot = graph.get_state(cfg)`                                                                                                                                                     |                                             |
| æ‰‹åŠ¨è¦†å†™Â StateÂ ï¼ˆçƒ­ä¿®å¤æˆ–äººå·¥å¹²é¢„ï¼‰ã€‚| `graph.update_state(cfg, {"counter": 0})`                                                                                                                                             |                                             |
| äººå·¥å®¡é˜…ã€å®¡æ‰¹ï¼›åœ¨èŠ‚ç‚¹å†…éƒ¨æš‚åœå¹¶ç­‰å¾…å¤–éƒ¨è¾“å…¥å†Â resumeã€‚| `python\nhuman = interrupt({'query': 'ç¡®è®¤ï¼Ÿ'})\nreturn Command(resume={'data': human})\n`                                                                                               |                                             |
|                                    |                                                                                                                                                                                       |                                             |
| å¯è§†åŒ–æ‰§è¡Œå›¾ï¼Œä¾¿äºè°ƒè¯•ä¸æ–‡æ¡£ã€‚| `graph.get_graph().draw_mermaid_png()`                                                                                                                                                |                                             |
| å¯è°ƒå¼è¾“å‡º                              | é€šè¿‡Â `with_structured_output`Â +Â Pydantic SchemaÂ ç›´æ¥æ‹¿åˆ°å¸ƒå°”/æšä¸¾å­—æ®µï¼Œé¿å…è§£æè‡ªç„¶è¯­è¨€å¯¼è‡´å‡ºé”™Â [Medium](https://medium.com/%40vivekvjnk/the-command-object-in-langgraph-bc29bf57d18f?utm_source=chatgpt.com)ã€‚|                                             |

> ğŸ’¡ **ä½¿ç”¨é¡ºåºå°è´´å£«**
>
> 1. **å»ºå›¾**ï¼š`StateGraph â†’ add_node/edge â†’ (ToolNode + tools_condition)`
>
> 2. **æŒä¹…åŒ–**ï¼š`compile(checkpointer)`
>
> 3. **è¿è¡Œ**ï¼š`stream / invoke`
>
> 4. **å›æº¯**ï¼š`get_state_history` + `checkpoint_id` â†’ â€œæ—¶é—´æ—…è¡Œâ€
>
> 5. **äººå·¥å®¡æ ¸**ï¼šèŠ‚ç‚¹å†… `interrupt` â†’ å¤–éƒ¨ `Command(resume=...)`
>

æŠŠè¿™å¼ è¡¨æ”¶è¿›å¸¸ç”¨ç¬”è®°ï¼Œå°±èƒ½åœ¨å†™ LangGraph å·¥ä½œæµæ—¶éšæ‰‹æŸ¥è¯¢ï¼Œä¸å†é¢‘ç¹ç¿»æ–‡æ¡£ã€‚ç¥å¼€å‘é¡ºåˆ©!

> **å‡è®¾å‰ç½®æ¡ä»¶**ï¼šè¯»è€…å¯¹ Python è¾ƒä¸ºç†Ÿæ‚‰ï¼Œäº†è§£åŸºæœ¬çš„ LLM æ¦‚å¿µï¼Œå¯¹ã€ŒAgent + å·¥å…·è°ƒç”¨ã€æˆ–ã€Œå¤šæ­¥å¯¹è¯æµç¨‹ã€ç­‰è¯é¢˜æœ‰åˆæ­¥äº†è§£å³å¯ã€‚
>
> **å…³äºç¯å¢ƒ**ï¼šå¦‚æœåœ¨ Colab ç¯å¢ƒä½¿ç”¨ï¼Œè¯·å…ˆ `!pip install langgraph openai`ã€‚
>
> **å…³äºæ¨¡å‹**ï¼šæœ¬æ•™ç¨‹ä»¥ OpenAI GPT-3.5/4 ä¸ºä¾‹ï¼Œå…¶ä»–æ¨¡å‹æˆ–ç§æœ‰ API çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œåªéœ€æ›¿æ¢ç›¸å…³é…ç½®ã€‚
>
> **æ•™å­¦ç›®æ ‡**ï¼šç†Ÿæ‚‰ LangGraph çš„æ ¸å¿ƒç†å¿µå’Œä¸»æµç”¨æ³•ï¼Œèƒ½åœ¨ 1~2 å¤©å†…å¿«é€Ÿä¸Šæ‰‹å¼€å‘å¤šæ­¥å¯¹è¯ã€Agent å·¥å…·é“¾å’Œå¯è§†åŒ–æµç¨‹å›¾ç­‰åŠŸèƒ½ã€‚

```mermaid
flowchart TB
    %% å®šä¹‰èŠ‚ç‚¹
    A((Start)):::start
    P[planner_node]
    S[supervisor_node]
    C[coordinator_node]
    R[reporter_node]
    E((End)):::end

    %% æ ·å¼
    classDef start fill:#cfc,stroke:#090,stroke-width:2px
    classDef end fill:#fcc,stroke:#900,stroke-width:2px

    %% é“¾æ¥å…³ç³»
    A --> P
    P -->|æ­£å¸¸æ‰§è¡Œ| S
    P -->|JSONè§£æå¤±è´¥ç­‰å¼‚å¸¸| E

    S -->|ä¸‹ä¸€æ­¥ä¸º planner| P
    S -->|ä¸‹ä¸€æ­¥ä¸º coordinator| C
    S -->|ä¸‹ä¸€æ­¥ä¸º reporter| R
    S -->|FINISH| E

    C -->|è‹¥åŒ…å« "handoff_to_planner"| P
    C -->|å¦åˆ™| E

    R --> S

```

---

  

## LangGraph åŸºç¡€æ•™ç¨‹

  

### ç›®å½•æ€»è§ˆ

  

1. [ç¬¬1æ­¥ï¼šå®‰è£…ä¸å¿«é€Ÿä½“éªŒ](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step1)
    
2. [ç¬¬2æ­¥ï¼šLangGraph æ ¸å¿ƒæ¦‚å¿µ â€”â€” èŠ‚ç‚¹ (Node) ä¸è¾¹ (Edge)](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step2)
    
3. [ç¬¬3æ­¥ï¼šæ„å»ºåŸºæœ¬æµç¨‹å›¾ï¼ˆFlowï¼‰](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step3)
    
4. [ç¬¬4æ­¥ï¼šå°† LangGraph ä¸ LLM ç»“åˆ](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step4)
    
5. [ç¬¬5æ­¥ï¼šAgent ä¸å·¥å…· (Tools) çš„ä½¿ç”¨](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step5)
    
6. [ç¬¬6æ­¥ï¼šå¤š Agent åä½œä¸é«˜çº§åœºæ™¯](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step6)
    
7. [ç¬¬7æ­¥ï¼šè°ƒè¯•ä¸å¯è§†åŒ–](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step7)
    
8. [ç¬¬8æ­¥ï¼šç¤ºä¾‹é¡¹ç›®ä¸ç®€å•è¯„ä¼°](https://chatgpt.com/c/67ff2786-d0fc-8010-b8e7-ed22cc22e2e2#step8)
    

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

  

---

  

### ç¬¬1æ­¥ï¼šå®‰è£…ä¸å¿«é€Ÿä½“éªŒ

  

#### ç†è®ºä»‹ç»

[LangGraph](https://github.com/langgraph-ai/langgraph)ï¼ˆç¤ºä¾‹é“¾æ¥ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå›¾ï¼ˆGraphï¼‰æ¦‚å¿µæ¥ç»„ç»‡è¯­è¨€æ¨¡å‹å¯¹è¯å’Œå¤šæ­¥éª¤æ¨ç†æµç¨‹çš„æ¡†æ¶ã€‚å®ƒå…è®¸ä½ å°†å¯¹è¯æ­¥éª¤æŠ½è±¡ä¸ºèŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡è¾¹æ¥å®šä¹‰èŠ‚ç‚¹é—´çš„æ•°æ®æµï¼›åŒæ—¶å†…ç½®äº†å¯¹å¤§è¯­è¨€æ¨¡å‹å’Œå·¥å…·å‡½æ•°çš„è°ƒç”¨æ”¯æŒï¼Œä½¿å¾—å¤æ‚çš„å¤šæ­¥å¯¹è¯ã€Agent æ¨æ–­ã€å·¥å…·ä½¿ç”¨éƒ½èƒ½é€šè¿‡ä¸€ä¸ªå¯è§†åŒ–æˆ–å¯ç¼–æ’çš„å›¾å½¢ç»“æ„æ¥å®ç°ã€‚

  

LangGraph çš„å…¸å‹ç”¨æ³•åŒ…æ‹¬ï¼š

1. **å¤šæ­¥å¯¹è¯æµç¨‹**ï¼šå°†å¯¹è¯çš„çŠ¶æ€å’Œé€»è¾‘æ‹†åˆ†æˆè‹¥å¹²èŠ‚ç‚¹ï¼ŒåŠ¨æ€æ‰§è¡Œï¼›
    
2. **Agent + å·¥å…·è°ƒç”¨**ï¼šåœ¨èŠ‚ç‚¹ä¸­è°ƒç”¨å¤–éƒ¨ APIã€æ£€ç´¢æ•°æ®åº“ã€æ‰§è¡Œ Python å‡½æ•°ç­‰ï¼›
    
3. **å¯è§†åŒ–**ï¼šä»¥å›¾çš„æ–¹å¼æŸ¥çœ‹æµç¨‹èµ°å‘ã€æ­¥éª¤é—´æ•°æ®ä¼ é€’ï¼›
    
4. **æ˜“äºè°ƒè¯•å’Œç»´æŠ¤**ï¼šå’Œä¼ ç»Ÿçš„å‡½æ•°å¼æˆ–æµæ°´çº¿å¼ç»„ç»‡ç›¸æ¯”ï¼Œå›¾ç»“æ„æ›´å…·çµæ´»æ€§ã€‚
    

  

æœ¬ç»ƒä¹ ä¼šå…ˆè®©ä½ å®‰è£… LangGraphï¼Œå¹¶å¿«é€Ÿä½“éªŒä¸€ä¸ªæœ€å°ç¤ºä¾‹ï¼šè®©ä¸€ä¸ªèŠ‚ç‚¹è°ƒç”¨ OpenAI æ¨¡å‹å›ç­”ç®€å•é—®é¢˜ã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. **å®‰è£… LangGraph**ï¼ˆå¦‚æœªå®‰è£…ï¼‰ï¼š`pip install langgraph openai`
    
2. **å¯¼å…¥å¹¶åˆå§‹åŒ–**ï¼šå¡«å†™è‡ªå·±çš„ OpenAI API Keyï¼›
    
3. **åˆ›å»ºä¸€ä¸ªç®€å•çš„å•èŠ‚ç‚¹å›¾**ï¼šè¯¥èŠ‚ç‚¹è°ƒç”¨ GPT-3.5/4 è¿”å›ç­”æ¡ˆï¼›
    
4. **æ‰§è¡Œå›¾**å¹¶æŸ¥çœ‹è¾“å‡ºç»“æœã€‚
    

  

ç¤ºä¾‹ä»£ç ï¼ˆå‡è®¾åœ¨æœ¬åœ°æˆ– Colab ä¸­è¿è¡Œï¼‰ï¼š

  

```Python
# ç¬¬1æ­¥ï¼šæ£€æŸ¥å®‰è£…å¹¶å¯¼å…¥
# è‹¥åœ¨æœ¬åœ°ï¼š pip install langgraph openai
import os
import openai

openai.api_key = "YOUR_OPENAI_API_KEY"  # TODO: æ›¿æ¢ä¸ºä½ çš„OpenAI Key

from langgraph import Graph, LLMNode

# åˆ›å»ºä¸€ä¸ªç©ºå›¾
graph = Graph(name="MyFirstLangGraph")

# åˆ›å»ºä¸€ä¸ªè°ƒç”¨ OpenAI LLM çš„èŠ‚ç‚¹
llm_node = LLMNode(
    name="simple_gpt_node",
    prompt_template="ä½ æ˜¯è°ï¼Ÿ",  # ä¸€ä¸ªéå¸¸ç®€å•çš„ Prompt
    openai_model_name="gpt-3.5-turbo",
    max_tokens=50
)

# å°†èŠ‚ç‚¹æ·»åŠ åˆ°å›¾ä¸­
graph.add_node(llm_node)

# è¿è¡Œå›¾
outputs = graph.run()
print("Graph outputs:", outputs)
```

  

#### éªŒè¯

  

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥åœ¨æ§åˆ¶å°æˆ– Notebook ä¸­çœ‹åˆ°ç±»ä¼¼ï¼š

```Java
Graph outputs: {
  "simple_gpt_node": "æˆ‘æ˜¯OpenAIçš„è¯­è¨€æ¨¡å‹â€¦â€¦"  # ç”± GPT è¿”å›çš„æ–‡æœ¬
}
```

  

å¯ä»¥ç”¨ä¸€ä¸ªç®€æ˜“æ–­è¨€æ¥åˆ¤æ–­æ˜¯å¦æ”¶åˆ°äº†å›ç­”ï¼š

  

```Python
answer_str = outputs.get("simple_gpt_node", "")
assert len(answer_str) > 0, "æœªèƒ½æ”¶åˆ° LLM çš„å›ç­”ï¼Œè¯·æ£€æŸ¥ API Key å’Œç½‘ç»œè¿æ¥ã€‚"
print("ç¬¬1æ­¥é€šè¿‡ï¼šLangGraph å®‰è£…å¹¶è¿›è¡Œæœ€å°ç¤ºä¾‹è°ƒç”¨æˆåŠŸã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬1æ­¥é€šè¿‡â€æ—¶ï¼Œè¯´æ˜ä½ å·²æˆåŠŸå®‰è£…å¹¶èƒ½ä½¿ç”¨ LangGraph åˆ›å»ºå›¾ã€æ‰§è¡ŒèŠ‚ç‚¹å¹¶è·å– LLM å“åº”ã€‚

  

---

  

### ç¬¬2æ­¥ï¼šLangGraph æ ¸å¿ƒæ¦‚å¿µâ€”â€”èŠ‚ç‚¹ (Node) ä¸è¾¹ (Edge)

  

#### ç†è®ºä»‹ç»

åœ¨ LangGraph ä¸­ï¼Œä¸€åˆ‡éƒ½å›´ç»•å›¾ (Graph) æ¥æ„å»ºã€‚

  

- **Nodeï¼ˆèŠ‚ç‚¹ï¼‰**ï¼šå¯¹åº”ä¸€ä¸ªå¯æ‰§è¡Œçš„æ­¥éª¤æˆ–ç®—å­ï¼Œæ¯”å¦‚ã€ŒLLM è°ƒç”¨ã€ã€ã€ŒPython å‡½æ•°æ‰§è¡Œã€ã€ã€ŒTool è°ƒç”¨ã€ç­‰ï¼›
    
- **Edgeï¼ˆè¾¹ï¼‰**ï¼šè¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµï¼Œé€šå¸¸åŒ…å«ã€ŒæºèŠ‚ç‚¹è¾“å‡º -> ç›®æ ‡èŠ‚ç‚¹è¾“å…¥ã€çš„æ˜ å°„å…³ç³»ï¼›
    
- **Graphï¼ˆå›¾ï¼‰**ï¼šç”±è‹¥å¹²èŠ‚ç‚¹ä¸è¾¹ç»„æˆï¼Œå®šä¹‰äº†æ•°æ®åœ¨æµç¨‹ä¸­çš„æµå‘ã€‚æ‰§è¡Œå›¾æ—¶ï¼ŒLangGraph ä¼šæ ¹æ®æ•°æ®ä¾èµ–å…³ç³»æ¥ä¾æ¬¡æˆ–å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¹¶å°†å„èŠ‚ç‚¹è¾“å‡ºæ±‡æ€»åˆ°æœ€åç»“æœã€‚
    

  

ä¸€ä¸ªæœ€å¸¸è§çš„æƒ…å½¢æ˜¯ï¼šæŸäº›èŠ‚ç‚¹æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¤„ç†åè¾“å‡ºç»“æœç»™ä¸‹æ¸¸èŠ‚ç‚¹ï¼Œç»§ç»­å¤„ç†æˆ–è°ƒç”¨å·¥å…·ï¼Œç›´åˆ°å¾—åˆ°ä¸€ä¸ªæœ€åçš„å›ç­”ã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. åˆ›å»ºä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼ŒåŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ï¼š
    
    1. ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°†è¾“å…¥æ–‡æœ¬è½¬æ¢æˆå¤§å†™ï¼›
        
    2. ç¬¬äºŒä¸ªèŠ‚ç‚¹è°ƒç”¨ GPT è¿›ä¸€æ­¥åšæ”¹å†™ã€‚
        
2. ä½¿ç”¨ **add_edge()** å°†è¿™ä¸¤ä¸ªèŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œä½¿ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºä½œä¸ºç¬¬äºŒä¸ªèŠ‚ç‚¹çš„è¾“å…¥ã€‚
    
3. è¿è¡Œå¹¶æŸ¥çœ‹ç»“æœã€‚
    

  

ç¤ºä¾‹ä»£ç ï¼š

```Python
from langgraph import Graph, PythonNode, LLMNode

# 1) å®šä¹‰å›¾
graph = Graph("TwoNodesDemo")

# 2) å®šä¹‰èŠ‚ç‚¹
uppercase_node = PythonNode(
    name="uppercase_node",
    python_callable=lambda text: text.upper()  # ç®€å•æŠŠæ–‡æœ¬è½¬å¤§å†™
)

llm_node = LLMNode(
    name="llm_node",
    prompt_template="å¯¹ä»¥ä¸‹æ–‡æœ¬è¿›è¡Œç®€çŸ­æ¶¦è‰²ï¼š{{input_text}}",
    openai_model_name="gpt-3.5-turbo",
    max_tokens=50
)

# 3) æ·»åŠ èŠ‚ç‚¹åˆ°å›¾
graph.add_node(uppercase_node)
graph.add_node(llm_node)

# 4) ç”¨è¾¹å°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºæ˜ å°„åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„è¾“å…¥
graph.add_edge(
    source_node=uppercase_node, 
    target_node=llm_node, 
    mapping={"return_value": "input_text"}
)

# 5) è®¾ç½®å›¾çš„è¾“å…¥ï¼Œå¹¶æ‰§è¡Œ
inputs = {"uppercase_node": {"text": "hello langgraph"}}
outputs = graph.run(inputs)
print("Graph outputs:", outputs)
```

  

#### éªŒè¯

  

- æ‰§è¡Œåï¼Œ`uppercase_node` ä¼šå…ˆå°† "hello langgraph" è½¬æˆ "HELLO LANGGRAPH"ï¼Œå†ä¼ ç»™ `llm_node` çš„ `input_text`ã€‚
    
- `llm_node` æ ¹æ®æç¤ºæ¨¡æ¿å¯¹è¿™æ®µå¤§å†™æ–‡æœ¬è¿›è¡Œæ¶¦è‰²æˆ–æ”¹å†™ï¼Œæœ€ç»ˆè¾“å‡ºåˆ° graph çš„ç»“æœã€‚
    
- ä½ åº”è¯¥çœ‹åˆ°ä¸€æ®µ GPT ç”Ÿæˆçš„æ–‡æœ¬ã€‚
    

  

å¯ä»¥åšä¸€ä¸ªç®€å•æ£€æŸ¥ï¼Œç¡®è®¤æœ€åˆçš„è¾“å…¥æ˜¯ "hello langgraph"ï¼Œæœ€ç»ˆ LLM èŠ‚ç‚¹å¤„ç†çš„æ˜¯å¤§å†™æ–‡æœ¬ï¼š

  

```Python
assert "HELLO LANGGRAPH" in outputs.get("llm_node", ""), "LLM è¾“å‡ºä¸åŒ…å«å¤§å†™æ–‡æœ¬ï¼Œå¯èƒ½æœªæ­£ç¡®è¿æ¥ã€‚"
print("ç¬¬2æ­¥é€šè¿‡ï¼šèŠ‚ç‚¹ä¸è¾¹çš„åŸºæœ¬ç”¨æ³•å·²æŒæ¡ã€‚")
```

  

å½“çœ‹åˆ°â€œç¬¬2æ­¥é€šè¿‡â€å¹¶è¾“å‡ºåˆä¹é€»è¾‘çš„æ–‡æœ¬ï¼Œè¡¨ç¤ºä½ å·²ç»ç†è§£äº† LangGraph ä¸­çš„ Node/Edge æ¦‚å¿µåŠæœ€ç®€å•çš„æ•°æ®æµè®¾ç½®ã€‚

  

---

  

### ç¬¬3æ­¥ï¼šæ„å»ºåŸºæœ¬æµç¨‹å›¾ï¼ˆFlowï¼‰

  

#### ç†è®ºä»‹ç»

  

LangGraph çš„æ ¸å¿ƒæ˜¯ä¸€å¼ å¯æ‰§è¡Œçš„æµç¨‹å›¾ (Flow / Graph)ã€‚é€šè¿‡ç¼–ç¨‹æˆ–å¯è§†åŒ–ç•Œé¢ï¼ˆå¦‚æœ LangGraph æä¾› GUIï¼‰æ¥ç»„åˆèŠ‚ç‚¹ã€é…ç½®è¾“å…¥/è¾“å‡ºæ˜ å°„ã€æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚å½“æˆ‘ä»¬æ‰§è¡Œ `graph.run()` æ—¶ï¼ŒLangGraph ä¼šè‡ªåŠ¨æŒ‰ç…§æ•°æ®ä¾èµ–é¡ºåºæ‰§è¡Œå„ä¸ªèŠ‚ç‚¹ã€‚

  

åœ¨å®é™…åœºæ™¯ä¸­ï¼Œä¸€ä¸ªæµç¨‹å›¾å¯èƒ½åŒ…å«ï¼š

- å¤šä¸ª PythonNode åšæ–‡æœ¬é¢„å¤„ç†ï¼›
    
- ä¸€ä¸ªæˆ–å¤šä¸ª LLMNode åšè¯­è¨€æ¨¡å‹è°ƒç”¨ï¼›
    
- ToolNode (å‡è®¾ LangGraph æä¾›) è°ƒç”¨å¤–éƒ¨æœç´¢ / æ•°æ®åº“ / æ–‡ä»¶è¯»å†™ï¼›
    
- ä»¥åŠå¤šè·¯åˆ†æ”¯ã€æ¡ä»¶åˆ¤æ–­ç­‰ã€‚
    

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. åˆ›å»ºä¸€ä¸ªæ›´å¤æ‚çš„æµç¨‹å›¾ï¼Œæ¯”å¦‚åŒ…å«ä¸‰åˆ°å››ä¸ªèŠ‚ç‚¹ï¼š
    
    1. Node Aï¼šå¯¹è¾“å…¥æ–‡æœ¬åšåˆ†å¥å¤„ç†ï¼›
        
    2. Node Bï¼šå¯¹æ¯ä¸ªå¥å­è°ƒç”¨ GPT è¿›è¡Œç¿»è¯‘ï¼›
        
    3. Node Cï¼šæ±‡æ€»ç¿»è¯‘ç»“æœï¼›
        
    4. ï¼ˆå¯é€‰ï¼‰Node Dï¼šå†æ¬¡è°ƒç”¨ GPT å¯¹æ±‡æ€»åšæ¶¦è‰²ã€‚
        
    
2. è¿æ¥è¿™äº›èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¤šæ­¥ç®¡çº¿ã€‚
    
3. è¾“å…¥ä¸€äº›æ–‡æœ¬å¹¶æ‰§è¡Œå›¾ï¼ŒæŸ¥çœ‹æœ€ç»ˆç»“æœã€‚
    

  

ç®€åŒ–ç¤ºä¾‹ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š

  

```Python
import re
from langgraph import Graph, PythonNode, LLMNode

def split_sentences(text):
    return re.split(r'[ã€‚ï¼ï¼Ÿ]', text)

def join_sentences(sentences):
    return " / ".join(sentences)

graph = Graph("TranslationFlow")

# Node A: åˆ†å¥å¤„ç†
split_node = PythonNode(
    name="split_node",
    python_callable=split_sentences
)

# Node B: å¯¹æ¯ä¸ªå¥å­è°ƒç”¨ GPT è¿›è¡Œç¿»è¯‘ï¼ˆå¯ç®€åŒ–ä¸ºæ‹¼æ¥åç»Ÿä¸€ç¿»è¯‘ï¼‰
translate_node = LLMNode(
    name="translate_node",
    prompt_template="è¯·æŠŠä¸‹é¢çš„æ–‡æœ¬ç¿»è¯‘æˆè‹±æ–‡ï¼š{{chinese_text}}",
    openai_model_name="gpt-3.5-turbo",
    max_tokens=100
)

# Node C: æ±‡æ€»ç¿»è¯‘ç»“æœ
join_node = PythonNode(
    name="join_node",
    python_callable=join_sentences
)

# å°†èŠ‚ç‚¹åŠ åˆ°å›¾ä¸­
graph.add_node(split_node)
graph.add_node(translate_node)
graph.add_node(join_node)

# è¾¹1: split_node -> translate_node
graph.add_edge(
    source_node=split_node,
    target_node=translate_node,
    mapping={"return_value": "chinese_text"}
)

# è¾¹2: translate_node -> join_node
graph.add_edge(
    source_node=translate_node,
    target_node=join_node,
    mapping={"return_value": "sentences"}  # è¿™é‡Œå‡è®¾ GPT è¾“å‡ºè‹¥å¹²å¥å­ï¼Œå¯ä»¥è¿›ä¸€æ­¥è§£æ
)

# è¾“å…¥ç¤ºä¾‹
inputs = {
    "split_node": {"text": "ä½ å¥½ï¼è¿™æ˜¯ä¸€æ¬¡ LangGraph æµ‹è¯•ã€‚ç°åœ¨å¼€å§‹å§ã€‚"}
}

outputs = graph.run(inputs)
print("Graph outputs:", outputs)
```

  

#### éªŒè¯

  

å¦‚æœæµç¨‹æ­£ç¡®ï¼š

- ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¾“å‡ºçš„åº”è¯¥æ˜¯ä¸€ä¸ªå¥å­åˆ—è¡¨ï¼Œå¦‚ `["ä½ å¥½", " è¿™æ˜¯ä¸€æ¬¡ LangGraph æµ‹è¯•", " ç°åœ¨å¼€å§‹å§", ""]`ï¼›
    
- ç¬¬äºŒä¸ªèŠ‚ç‚¹åº”å°†è¿™äº›å¥å­æ‹¼æ¥åç¿»è¯‘æˆè‹±æ–‡ï¼›
    
- ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å†å°†ç¿»è¯‘ç»“æœæ•´ç†æˆå­—ç¬¦ä¸²æˆ–è¿›è¡Œåˆå¹¶å¤„ç†ã€‚
    

  

ä½ åº”è¯¥èƒ½çœ‹åˆ°æœ€ç»ˆçš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ±‡æ€»çš„è‹±æ–‡ç¿»è¯‘ç»“æœã€‚æ ¹æ®å…·ä½“ Prompt æ¨¡æ¿åŠ GPT çš„å›å¤ï¼Œç»“æœå¯èƒ½ç•¥æœ‰ä¸åŒã€‚

  

å¯ä»¥ç®€å•æ–­è¨€è¾“å‡ºä¸­åŒ…å«ä¸€äº›è‹±æ–‡å•è¯ï¼š

  

```Python
final_output = outputs.get("join_node", "")
assert any(word in final_output.lower() for word in ["langgraph", "hello", "test"]), "ç¿»è¯‘ç»“æœä¼¼ä¹ä¸åŒ…å«æœŸæœ›çš„è‹±æ–‡å†…å®¹ã€‚"
print("ç¬¬3æ­¥é€šè¿‡ï¼šæˆåŠŸæ„å»ºå¹¶è¿è¡Œä¸€ä¸ªåŸºç¡€å¤šèŠ‚ç‚¹æµç¨‹å›¾ã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬3æ­¥é€šè¿‡â€æ—¶ï¼Œè¡¨ç¤ºä½ å·²ç»èƒ½å¤Ÿåœ¨ LangGraph ä¸­æ„å»ºå¤šä¸ªèŠ‚ç‚¹å¹¶å°†å…¶ç»„ç»‡æˆæ•°æ®æµæ‰§è¡Œã€‚

  

---

  

### ç¬¬4æ­¥ï¼šå°† LangGraph ä¸ LLM ç»“åˆ

  

#### ç†è®ºä»‹ç»

  

åœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬å…¶å®å·²ç»ç”¨åˆ° LLMNodeï¼Œä½†è¿™ä¸€èŠ‚æ›´ç³»ç»Ÿåœ°ä»‹ç»å¦‚ä½•ç®¡ç† LLM é…ç½®ã€‚LangGraph é€šå¸¸æä¾›ï¼š

- **LLMNode**ï¼šé€šç”¨ GPT è°ƒç”¨èŠ‚ç‚¹ï¼›
    
- **ç³»ç»Ÿçº§å‚æ•°**ï¼šå¦‚ OpenAI keyã€model åç§°ã€max_tokensã€temperatureï¼›
    
- **Prompt æ¨¡æ¿**ï¼šå¯ä½¿ç”¨ Jinja2 é£æ ¼çš„ `{{var}}` å ä½ç¬¦æ‹¼æ¥ä¸Šä¸‹æ–‡ã€‚
    

  

ä½ è¿˜å¯ä»¥è‡ªå®šä¹‰PromptNodeæˆ–LLMNodeæ¥å¯¹ Prompt è¿›è¡Œæ›´å¤šç»†åŒ–æ§åˆ¶ï¼Œæ¯”å¦‚ï¼šsystem promptã€user promptã€few-shot example ç­‰ã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ LLMNodeï¼Œåœ¨å…¶ä¸­æŒ‡å®š system promptã€user promptï¼Œæˆ– few-shot exampleï¼›
    
2. å°†å…¶æ•´åˆè¿›ä¸€ä¸ªå°çš„ graphï¼›
    
3. è°ƒè¯• temperatureã€max_tokens ç­‰å‚æ•°ï¼Œè§‚å¯Ÿå›ç­”é£æ ¼å˜åŒ–ã€‚
    

  

ç¤ºä¾‹ï¼š

  

```Python
from langgraph import Graph, LLMNode

graph = Graph("CustomLLMConfig")

custom_llm_node = LLMNode(
    name="custom_llm_node",
    openai_model_name="gpt-3.5-turbo",
    max_tokens=100,
    temperature=0.8,
    # ä¸‹é¢è¿™æ®µ prompt_template å¯ä»¥åŒ…å«æ›´å¤šä¸Šä¸‹æ–‡
    prompt_template="""ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹å¯¹è¯ï¼š
1) é—®ï¼šä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ ç­”ï¼šæ™´è½¬å¤šäº‘ã€‚
2) é—®ï¼šä½ å¥½ï¼ä½ æ˜¯è°ï¼Ÿ ç­”ï¼šæˆ‘æ˜¯ä¸€ä¸ªè¯­è¨€æ¨¡å‹åŠ©æ‰‹ã€‚

ç°åœ¨è¯·å›ç­”æˆ‘çš„é—®é¢˜ï¼š
{{user_input}}
""",
)

graph.add_node(custom_llm_node)

# ä¸ºäº†è®©å¤–éƒ¨è¾“å…¥ç›´æ¥è¿› user_input
inputs = {
    "custom_llm_node": {
        "user_input": "è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ï¼Œå¹¶è¯´æ˜LangGraphçš„ç‰¹ç‚¹ã€‚"
    }
}
outputs = graph.run(inputs)
print("Graph outputs:", outputs)
```

  

#### éªŒè¯

  

å¦‚æœæ‰§è¡Œæ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°å›ç­”ä¸­æ—¢æœ‰è‡ªæˆ‘ä»‹ç»ï¼Œä¹Ÿæåˆ°äº† LangGraph çš„ä¸€äº›ç‰¹ç‚¹ï¼ˆå¦‚æœä¸Šä¸‹æ–‡æˆ– ChatGPT ä¸çŸ¥é“ï¼Œä¼šç¼–é€ ä¸€äº›åˆç†çš„è§£é‡Šï¼‰ã€‚

å¯ä»¥åšä¸ªç®€å•æ–­è¨€ï¼Œä¿è¯å›ç­”éç©ºï¼š

  

```Python
assert len(outputs.get("custom_llm_node", "")) > 0, "LLM å›ç­”ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ Prompt æˆ– API Keyã€‚"
print("ç¬¬4æ­¥é€šè¿‡ï¼šçµæ´»å®šåˆ¶ LLM èŠ‚ç‚¹ä¸ Prompt æ¨¡æ¿å·²å®Œæˆã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬4æ­¥é€šè¿‡â€å¹¶èƒ½çœ‹åˆ°å¸¦æœ‰ç¤ºä¾‹æ ¼å¼æˆ–å¤šå¥å›ç­”ï¼Œè¯´æ˜ä½ å·²ç»æŒæ¡äº†å¦‚ä½•åœ¨ LangGraph ä¸­è‡ªå®šä¹‰ LLM è°ƒç”¨æ–¹å¼ä¸å‚æ•°ã€‚

  

---

  

### ç¬¬5æ­¥ï¼šAgent ä¸å·¥å…· (Tools) çš„ä½¿ç”¨

  

#### ç†è®ºä»‹ç»

  

å¾ˆå¤šåŸºäº LangChainã€LangGraph ç­‰æ¡†æ¶çš„æ ¸å¿ƒæ˜¯Agentæ¦‚å¿µï¼šè®©è¯­è¨€æ¨¡å‹åœ¨å¯¹è¯ä¸­èƒ½â€œæ€è€ƒâ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶è°ƒç”¨å¤–éƒ¨å·¥å…· (Tool) æ¥å®Œæˆç‰¹å®šä»»åŠ¡ï¼ˆä¾‹å¦‚æœç´¢ã€æ•°æ®åº“æŸ¥è¯¢ã€è®¡ç®—ç­‰ï¼‰ã€‚LangGraph ä¹Ÿå¯èƒ½æä¾›AgentNodeæˆ–è€…ToolNodeæ¥æ”¯æŒï¼š

  

1. **AgentNode**ï¼šåœ¨å¯¹è¯è¿‡ç¨‹ä¸­åŠ¨æ€å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·ï¼›
    
2. **Tool**ï¼šå¯ä»¥æ˜¯ Python å‡½æ•°ã€APIã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼›
    
3. **å·¥å…·è°ƒç”¨è¿‡ç¨‹**ï¼šè¯­è¨€æ¨¡å‹ä¼šæ ¹æ®ä¸Šä¸‹æ–‡å’Œæç¤ºåˆ¤æ–­ä½•æ—¶è°ƒç”¨å·¥å…·ï¼Œå¦‚ä½•ä½¿ç”¨å…¶è¾“å‡ºï¼Œå†ç»™å‡ºæœ€ç»ˆå›ç­”ã€‚
    

  

æœ¬èŠ‚ç¤ºä¾‹ï¼šæˆ‘ä»¬æ„å»ºä¸€ä¸ª Agent èŠ‚ç‚¹ï¼Œé…å¤‡ä¸€ä¸ªæˆ–å¤šä¸ª Toolsï¼Œè®©ç”¨æˆ·æé—®æ—¶ Agent å†³å®šæ˜¯å¦è°ƒç”¨ Tool æ¥è·å–ç­”æ¡ˆã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. å®šä¹‰ä¸€ä¸ªç®€å•çš„ Toolï¼šä¾‹å¦‚åšå››åˆ™è¿ç®—ï¼Œæˆ–è€…è·å–å½“å‰æ—¶é—´ï¼›
    
2. å®šä¹‰ä¸€ä¸ª AgentNodeï¼Œå°†è¯¥ Tool æ³¨å†Œè¿›å»ï¼›
    
3. æ„å»ºä¸€ä¸ª Graphï¼Œè®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªé—®é¢˜ï¼ˆæ¯”å¦‚è¦æ±‚è®¡ç®—æŸäº›æ•°å€¼ï¼‰ï¼Œçœ‹çœ‹ Agent æ˜¯å¦ä¼šè‡ªåŠ¨è°ƒç”¨ Tool å¹¶è¿”å›æ­£ç¡®ç»“æœã€‚
    

  

ç¤ºä¾‹ï¼ˆç¤ºæ„ï¼‰ï¼š

  

```Python
from langgraph import Graph, AgentNode, Tool

# å®šä¹‰ä¸€ä¸ªç®€å•çš„Tool: è¿›è¡ŒåŠ æ³•è¿ç®—
def add_numbers(x, y):
    return x + y

add_tool = Tool(
    name="add_tool",
    description="è¿›è¡ŒåŠ æ³•è¿ç®—, å‚æ•°: x, y",
    func=add_numbers
)

# å®šä¹‰AgentNode: å…è®¸è°ƒç”¨ add_tool
agent_node = AgentNode(
    name="math_agent",
    tools=[add_tool],
    # ä¸€ä¸ªç®€æ˜“ promptï¼Œå¼•å¯¼Agentä½•æ—¶è°ƒç”¨å·¥å…·
    system_prompt="ä½ æ˜¯ä¸€ä¸ªæ“…é•¿æ•°å­¦è®¡ç®—çš„åŠ©æ‰‹ï¼Œå¿…è¦æ—¶å¯è°ƒç”¨å·¥å…·æ¥è®¡ç®—ã€‚",
    openai_model_name="gpt-3.5-turbo"
)

graph = Graph("AgentToolsDemo")
graph.add_node(agent_node)

# è¾“å…¥ä¸€ä¸ªéœ€è¦è®¡ç®—çš„é—®é¢˜
inputs = {
    "math_agent": {
        "user_input": "è¯·å¸®æˆ‘è®¡ç®— 12345 åŠ ä¸Š 67890 ç­‰äºå¤šå°‘ï¼Ÿ"
    }
}
outputs = graph.run(inputs)
print("Graph outputs:", outputs)
```

  

#### éªŒè¯

  

è‹¥ Agent é€»è¾‘æ­£å¸¸ï¼Œå®ƒä¼šâ€œæ€è€ƒâ€è¦è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç„¶åè°ƒç”¨ add_toolï¼Œå†å°†ç»“æœæ•´åˆåˆ°å›ç­”ä¸­ã€‚è¾“å‡ºæ ¼å¼è§†å…·ä½“å®ç°è€Œå®šï¼Œå¯èƒ½ç±»ä¼¼ï¼š

  

```Java
"math_agent": "æˆ‘è°ƒç”¨äº† add_tool(12345, 67890) å¾—åˆ°ç»“æœ 80235ã€‚ç­”æ¡ˆæ˜¯ 80235ã€‚"
```

  

å¯å¯¹å›ç­”åšä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ¤æ–­ï¼Œä¹Ÿå¯è§£æå›ç­”æ˜¯å¦åŒ…å«æ­£ç¡®çš„æ•°å­—ï¼š

  

```Python
pred = outputs.get("math_agent", "")
assert "80235" in pred, "Agent å·¥å…·è°ƒç”¨ç»“æœä¸æ­£ç¡®ï¼Œå¯èƒ½å·¥å…·æœªè¢«æ­£ç¡®è°ƒç”¨ã€‚"
print("ç¬¬5æ­¥é€šè¿‡ï¼šAgent + å·¥å…·çš„ç®€å•æ¼”ç¤ºå®Œæˆã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬5æ­¥é€šè¿‡â€ä¸”è¿”å›åŒ…å«æ­£ç¡®çš„åŠ æ³•ç»“æœï¼Œå³è¯´æ˜ä½ å·²ç»äº†è§£äº† LangGraph ä¸­ Agent/Tool çš„åŸºæœ¬ç”¨æ³•ã€‚

  

---

  

### ç¬¬6æ­¥ï¼šå¤š Agent åä½œä¸é«˜çº§åœºæ™¯

  

#### ç†è®ºä»‹ç»

  

**å¤š Agent åä½œ**æŒ‡åœ¨åŒä¸€ä¸ªå¯¹è¯æˆ–æµç¨‹ä¸­ï¼Œå­˜åœ¨å¤šä¸ª Agent èŠ‚ç‚¹ï¼Œå„è‡ªæœ‰ä¸åŒçš„å·¥å…·æˆ–ä¸“é•¿ï¼Œå½¼æ­¤é€šè¿‡å›¾çš„è¾¹è¿›è¡Œä¿¡æ¯äº¤äº’ï¼ŒååŒå®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼š

  

- Agent A ä¸“ç²¾æ•°å­¦è®¡ç®—å·¥å…·ï¼›
    
- Agent B ä¸“ç²¾å¤–éƒ¨ API è¯·æ±‚æˆ–æ•°æ®åº“æŸ¥è¯¢ï¼›
    
- é€šè¿‡å›¾ç»“æ„ï¼Œå°† Agent A çš„è¾“å‡ºä¼ ç»™ Agent Bï¼›
    
- æˆ–è€…å¹¶è¡Œåœ°è®©ä¸¤ä¸ª Agent å»å¤„ç†ä¸åŒå­é—®é¢˜ï¼Œæœ€åæ•´åˆç­”æ¡ˆã€‚
    

  

LangGraph çš„å›¾å¼ç»“æ„è®©æ­¤ç±»åœºæ™¯æ›´æ˜“å®ç°ï¼šæ¯ä¸ª AgentNode éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¾¹åˆ™å®šä¹‰äº†å®ƒä»¬å¦‚ä½•äº¤æ¢ä¿¡æ¯ã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. å®šä¹‰ä¸¤ä¸ª AgentNodeï¼Œå„è‡ªåŒ…å«ä¸åŒçš„ Tools
    
2. åœ¨ Graph ä¸­å°†å®ƒä»¬ä¸²è”æˆ–è€…å¹¶è¡Œï¼Œç„¶åå†ç”±ä¸€ä¸ª PythonNode æ±‡æ€»å®ƒä»¬çš„ç»“æœï¼›
    
3. æ¨¡æ‹Ÿä¸€ä¸ªé—®é¢˜ï¼Œè§‚å¯Ÿå¤š Agent ä¹‹é—´å¦‚ä½•åä½œã€‚
    

  

ç¤ºä¾‹ï¼ˆæ€è·¯æ¼”ç¤ºï¼‰ï¼š

  

```Python
from langgraph import Graph, AgentNode, Tool, PythonNode

# Tool 1: æ•°å­¦åŠ æ³•
def add_numbers(x, y):
    return x + y

math_tool = Tool(name="add_tool", func=add_numbers, description="æ•°å­¦åŠ æ³•")

# Tool 2: ä¸€ä¸ªç®€å•ç¿»è¯‘å‡½æ•° (çº¯ Python æ¼”ç¤º)
def simple_translate(text):
    return "Translated:" + text  # ä¼ªç¿»è¯‘

translate_tool = Tool(name="translate_tool", func=simple_translate, description="ç¿»è¯‘æ–‡æœ¬")

# Agent A: æ“…é•¿æ•°å­¦
agent_a = AgentNode(
    name="agent_a",
    tools=[math_tool],
    system_prompt="ä½ æ“…é•¿æ•°å­¦è®¡ç®—ï¼Œæœ‰ add_tool å¯ä½¿ç”¨ã€‚",
    openai_model_name="gpt-3.5-turbo"
)

# Agent B: æ“…é•¿ç¿»è¯‘
agent_b = AgentNode(
    name="agent_b",
    tools=[translate_tool],
    system_prompt="ä½ æ“…é•¿ç¿»è¯‘æ–‡æœ¬ï¼Œæœ‰ translate_tool å¯ä½¿ç”¨ã€‚",
    openai_model_name="gpt-3.5-turbo"
)

# PythonNode: æ±‡æ€»
def combine_results(math_str, translate_str):
    return f"MathResult: {math_str}\nTranslateResult: {translate_str}"

summary_node = PythonNode(name="summary_node", python_callable=combine_results)

# æ„å»ºå›¾
graph = Graph("MultiAgentDemo")
graph.add_node(agent_a)
graph.add_node(agent_b)
graph.add_node(summary_node)

# è®©Agent Aåšä¸ªæ•°å­¦è®¡ç®—åï¼ŒAgent B ä¹Ÿç¿»è¯‘ä¸€å¥è¯
# è¿™é‡Œæˆ‘ä»¬é€šè¿‡ graph inputs åˆ†åˆ«ç»™ agent_a, agent_b
inputs = {
    "agent_a": {"user_input": "è¯·è®¡ç®— 99 + 1ã€‚"},
    "agent_b": {"user_input": "ç¿»è¯‘ï¼šä½ å¥½ä¸–ç•Œ"}
}

# æ¥ä¸‹æ¥ï¼Œéœ€è¦å°†ä¸¤ä¸ªAgentçš„è¾“å‡ºéƒ½è¾“å…¥ç»™ summary_node
graph.add_edge(
    source_node=agent_a,
    target_node=summary_node,
    mapping={"return_value": "math_str"}
)
graph.add_edge(
    source_node=agent_b,
    target_node=summary_node,
    mapping={"return_value": "translate_str"}
)

# æ‰§è¡Œ
outputs = graph.run(inputs)
print("Final Outputs:", outputs)
```

  

#### éªŒè¯

  

- è¿è¡Œåï¼Œ`agent_a` è¿”å›åŠ æ³•ç»“æœï¼ˆå¦‚ "100"ï¼‰ï¼Œ`agent_b` è¿”å›ç¿»è¯‘ç»“æœï¼ˆå¦‚ "Translated:ä½ å¥½ä¸–ç•Œ"ï¼‰ï¼Œ`summary_node` å°†è¿™ä¸¤è€…åˆå¹¶ï¼›
    
- æœ€ç»ˆè¾“å‡ºä¼šåœ¨ `summary_node` ä¸­çœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰ä¸¤æ®µä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚
    

  

å¯ä»¥æ–­è¨€ä¸€ä¸‹ï¼š

  

```Python
summary_text = outputs.get("summary_node", "")
assert "MathResult" in summary_text and "TranslateResult" in summary_text, "å¤šAgentç»“æœæ±‡æ€»ä¸å®Œæ•´"
print("ç¬¬6æ­¥é€šè¿‡ï¼šå¤šAgentåä½œä¸é«˜çº§åœºæ™¯ç¤ºä¾‹å®Œæˆã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬6æ­¥é€šè¿‡â€å¹¶æ‰“å°å‡ºåˆå¹¶åçš„ä¿¡æ¯ï¼Œè¯´æ˜ä½ å·²ç»äº†è§£äº†å¦‚ä½•åœ¨å›¾ä¸­åˆ›å»ºå¤šä¸ª AgentNode å¹¶è®©å®ƒä»¬åä½œè§£å†³ä»»åŠ¡ã€‚

  

---

  

### ç¬¬7æ­¥ï¼šè°ƒè¯•ä¸å¯è§†åŒ–

  

#### ç†è®ºä»‹ç»

LangGraph çš„å›¾ç»“æ„ä¸ºè°ƒè¯•æä¾›äº†ä¼˜åŠ¿ï¼šä½ å¯ä»¥æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥ã€è¾“å‡ºã€æ‰§è¡Œæ—¥å¿—ï¼›å¦‚æœå®ƒæ”¯æŒ GUI æˆ–è€…å¯¼å‡ºåˆ°æŸäº›å¯è§†åŒ–å·¥å…·ï¼ˆå¦‚ Graphviz ç­‰ï¼‰ï¼Œå°±èƒ½åœ¨å›¾å½¢ç•Œé¢ç›´è§‚åœ°æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥ã€‚

  

è°ƒè¯•æ–¹æ³•ï¼š

1. **æ—¥å¿—**ï¼šLangGraph å¯èƒ½æä¾› debug æ¨¡å¼æˆ–è¿”å›è¯¦ç»†çš„ node execution logï¼›
    
2. **å¯è§†åŒ–**ï¼šå°†å›¾å¯¼å‡ºä¸º.dot æ–‡ä»¶æˆ–ç±»ä¼¼æ ¼å¼ï¼Œç”¨ graphvizã€mermaid æˆ–æµè§ˆå™¨æŸ¥çœ‹ï¼›
    
3. **ä¸­é—´ç»“æœæ£€æŸ¥**ï¼šåœ¨æ‰§è¡ŒåæŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„ outputsï¼Œæ’æŸ¥å‡ºé”™èŠ‚ç‚¹ã€‚
    

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. å°†ä¹‹å‰çš„å›¾å¯ç”¨ debug çº§åˆ«æ—¥å¿—ï¼ˆè‹¥ LangGraph æä¾›ç±»ä¼¼ `graph.run(debug=True)` æˆ– logger è®¾å®šï¼‰ï¼›
    
2. æ‰“å°æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥ã€è¾“å‡ºï¼›
    
3. å°è¯•å¯¼å‡ºå›¾ä¸ºå¯è§†åŒ–æ–‡ä»¶ (å¦‚ `.dot`) å¹¶æŸ¥çœ‹ã€‚
    

  

ç¤ºä¾‹ï¼ˆè§† LangGraph å…·ä½“API è€Œå®šï¼Œè¿™é‡Œä»…ç¤ºæ„ï¼‰ï¼š

  

```Python
# å‡è®¾åœ¨å‰é¢å®šä¹‰çš„ graph åŸºç¡€ä¸Š
outputs = graph.run(inputs, debug=True)

# å‡è®¾ LangGraph å†…éƒ¨ä¼šè¾“å‡ºèŠ‚ç‚¹æ‰§è¡Œæ—¥å¿—
# æˆ–è€…å¯ä»¥è·å– graph.execution_trace

print("Execution Trace:")
for step in graph.execution_trace:
    print(step)

# å¯¼å‡ºå¯è§†åŒ–
graph.save_dot("my_langgraph.dot")
print("å·²å¯¼å‡ºåˆ° my_langgraph.dotï¼Œå¯ç”¨ graphviz æŸ¥çœ‹ã€‚")
```

  

#### éªŒè¯

  

- æ£€æŸ¥åœ¨æ§åˆ¶å°é‡Œèƒ½çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥ä¸è¾“å‡ºï¼›
    
- æŸ¥çœ‹ `.dot` æ–‡ä»¶æ˜¯å¦ç”Ÿæˆï¼›
    
- è‹¥æœ‰åˆé€‚ç¯å¢ƒï¼ˆgraphviz ç­‰ï¼‰ï¼Œå¯ä»¥ç”¨ `dot -Tpng my_langgraph.dot -o out.png` è½¬æˆå›¾ç‰‡ï¼Œçœ‹æµç¨‹å›¾æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
    

  

è‹¥èƒ½æˆåŠŸå¯¼å‡ºå¹¶æŸ¥çœ‹ï¼Œå°±è¯´æ˜å·²æŒæ¡åŸºæœ¬çš„è°ƒè¯•å’Œå¯è§†åŒ–æ–¹æ³•ï¼š

  

```Python
import os
assert os.path.exists("my_langgraph.dot"), "å¯è§†åŒ–æ–‡ä»¶æœªç”Ÿæˆï¼Œæ£€æŸ¥ save_dot è°ƒç”¨ã€‚"
print("ç¬¬7æ­¥é€šè¿‡ï¼šè°ƒè¯•ä¸å¯è§†åŒ–çš„åŸºç¡€æ“ä½œæˆåŠŸã€‚")
```

  

---

  

### ç¬¬8æ­¥ï¼šç¤ºä¾‹é¡¹ç›®ä¸ç®€å•è¯„ä¼°

  

#### ç†è®ºä»‹ç»

  

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»å­¦ä¼šäº†ï¼š

  

1. **åˆ›å»º Graph** å¹¶æ·»åŠ å„ç±»èŠ‚ç‚¹ï¼ˆPythonNodeã€LLMNodeã€AgentNode ç­‰ï¼‰ï¼›
    
2. **ä½¿ç”¨ Edge** åœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ•°æ®ï¼›
    
3. **é…ç½® LLMã€Agentã€Tool** ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚
    
4. è¿›è¡ŒåŸºæœ¬è°ƒè¯•å’Œå¯è§†åŒ–ã€‚
    

  

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¾€å¾€éœ€è¦å¯¹ Agent æˆ–æµç¨‹è¿›è¡Œè¯„ä¼°ï¼š

  

- **åŠŸèƒ½æ€§è¯„ä¼°**ï¼šçœ‹æ˜¯å¦èƒ½æ­£ç¡®è°ƒç”¨å·¥å…·ã€æ­£ç¡®å›ç­”é—®é¢˜ï¼›
    
- **è´¨é‡è¯„ä¼°**ï¼šä¸åŸºå‡†ç­”æ¡ˆå¯¹æ¯”æˆ–è®¡ç®—ç›¸ä¼¼åº¦ã€æ‹¼å†™æ£€æŸ¥ç­‰ï¼›
    
- **äººå·¥å®¡é˜…**ï¼šå¯¹äºç”Ÿæˆå¼ä»»åŠ¡ï¼Œè¿˜å¯äººå·¥æ ‡æ³¨ã€æ‰“åˆ†ã€‚
    

  

æœ¬èŠ‚é€šè¿‡ä¸€ä¸ªå°â€œçŸ¥è¯†é—®ç­”â€é¡¹ç›®ç¤ºä¾‹ï¼Œè®©ä½ æŠŠæ•´ä¸ªæµç¨‹ä¸²èµ·æ¥ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨åŒ–è¯„ä¼°ã€‚

  

#### ç¼–ç¨‹ä»»åŠ¡

  

1. è®¾è®¡ä¸€ä¸ªåŒ…å« AgentNode + å·¥å…·ï¼ˆå¯ç»“åˆè‡ªå®šä¹‰æ£€ç´¢å‡½æ•°ã€æ•°æ®åº“æŸ¥è¯¢æˆ–ç›´æ¥ç¡¬ç¼–ç ä¸€ä¸ªçŸ¥è¯†åº“ï¼‰çš„æµç¨‹ï¼›
    
2. è®©ç”¨æˆ·æå‡ºé—®é¢˜åï¼ŒAgent è°ƒç”¨è¯¥å·¥å…·æŸ¥è¯¢ç­”æ¡ˆï¼Œå†è¿”å›ç»™ç”¨æˆ·ï¼›
    
3. å‡†å¤‡ä¸€äº›æµ‹è¯•é—®ç­”å¯¹è¿›è¡Œè‡ªåŠ¨åŒ–è„šæœ¬æµ‹è¯•ï¼Œè®¡ç®—ç®€å•å‡†ç¡®ç‡ï¼›
    
4. æ‰“å°æœ€ç»ˆè¯„ä¼°åˆ†æ•°ã€‚
    

  

ç¤ºä¾‹ï¼š

  

```Python
from langgraph import Graph, AgentNode, Tool

# å‡è®¾æˆ‘ä»¬æœ‰ä¸ªç®€å•çŸ¥è¯†åº“
knowledge_db = {
    "LangGraph": "LangGraph æ˜¯ä¸€ä¸ªç”¨å›¾ç»“æ„æ¥ç»„ç»‡LLMé€»è¾‘çš„æ¡†æ¶ã€‚",
    "Python": "Pythonæ˜¯ä¸€ç§é«˜å±‚æ¬¡è§£é‡Šå‹è¯­è¨€ã€‚",
}

def retrieve_answer(keyword):
    return knowledge_db.get(keyword, "æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯")

# å®šä¹‰Tool
db_tool = Tool(
    name="db_retrieval",
    description="æ ¹æ®å…³é”®è¯æ£€ç´¢ç®€å•çŸ¥è¯†åº“",
    func=retrieve_answer
)

# å®šä¹‰AgentNode
agent_node = AgentNode(
    name="qa_agent",
    tools=[db_tool],
    system_prompt="ä½ å¯ä»¥ä½¿ç”¨ [db_retrieval] å·¥å…·ï¼Œæ ¹æ®å…³é”®è¯ä»çŸ¥è¯†åº“è·å–ä¿¡æ¯ï¼Œç„¶åå›ç­”ç”¨æˆ·é—®é¢˜ã€‚",
    openai_model_name="gpt-3.5-turbo"
)

graph = Graph("KnowledgeQADemo")
graph.add_node(agent_node)

# æµ‹è¯•é—®ç­”å¯¹
test_data = [
    ("ä»€ä¹ˆæ˜¯LangGraphï¼Ÿ", "LangGraph æ˜¯ä¸€ä¸ªç”¨å›¾ç»“æ„æ¥ç»„ç»‡LLMé€»è¾‘çš„æ¡†æ¶ã€‚"),
    ("Pythonæ˜¯ä»€ä¹ˆï¼Ÿ", "Pythonæ˜¯ä¸€ç§é«˜å±‚æ¬¡è§£é‡Šå‹è¯­è¨€ã€‚"),
]

def simple_eval(pred, gold):
    # ç®€å•è§„åˆ™ï¼šå¦‚æœ gold å­ä¸²å‡ºç°åœ¨ pred ä¸­ï¼Œå°±ç»™1åˆ†
    return 1.0 if gold in pred else 0.0

scores = []
for question, gold in test_data:
    outputs = graph.run({"qa_agent": {"user_input": question}})
    pred_ans = outputs.get("qa_agent", "")
    score = simple_eval(pred_ans, gold)
    scores.append(score)
    print(f"Q: {question}\nPred: {pred_ans}\nGold: {gold}\nScore: {score}\n---")

avg_score = sum(scores) / len(scores)
print("å¹³å‡å¾—åˆ†:", avg_score)
```

  

#### éªŒè¯

  

è‹¥ Agent èƒ½æ­£å¸¸è°ƒç”¨ `db_retrieval` å·¥å…·ï¼Œå¹¶åœ¨å›ç­”ä¸­åŒ…å«æ­£ç¡®çš„çŸ¥è¯†ç‚¹ï¼Œä½ ä¼šçœ‹åˆ°è¾ƒé«˜çš„å¾—åˆ†ï¼ˆä¾‹å¦‚ 1.0 æˆ– 0.5 ä¹‹ç±»ï¼‰ã€‚è‹¥ Agent å›ç­”å‡ºç°åå·®ï¼Œä¹Ÿèƒ½åœ¨è¿™é‡Œåæ˜ å‡ºæ¥ã€‚

å¯ä»¥åŠ ä¸ªæ–­è¨€ï¼Œå¦‚æœå¹³å‡å¾—åˆ† < 0.5ï¼Œå¯èƒ½è¯´æ˜å·¥å…·è°ƒç”¨æˆ–æç¤ºä¸å¤Ÿæ˜ç¡®ï¼š

  

```Python
assert avg_score >= 0.5, "å¹³å‡å¾—åˆ†è¿‡ä½ï¼ŒAgent æœªæ­£ç¡®ä½¿ç”¨çŸ¥è¯†åº“æˆ–å›ç­”ä¸å‡†ç¡®ã€‚"
print("ç¬¬8æ­¥é€šè¿‡ï¼šå®Œæ•´é¡¹ç›®ç¤ºä¾‹ä¸ç®€å•è¯„ä¼°æµç¨‹å®Œæˆã€‚")
```

  

å½“è¾“å‡ºâ€œç¬¬8æ­¥é€šè¿‡â€å¹¶å¾—åˆ°åˆç†çš„å¾—åˆ†ï¼Œä½ ä¾¿å®Œæˆäº†ä¸€ä¸ªè¾ƒå®Œæ•´çš„ LangGraph åŸºç¡€ç»ƒä¹ ã€‚

  

---

  

## æ€»ç»“

  

**æ­å–œä½ ï¼** é€šè¿‡ä¸Šè¿° 8 ä¸ªæ­¥éª¤çš„ç¤ºä¾‹ä¸ç»ƒä¹ ï¼Œä½ å·²ç»ä»é›¶èµ·æ­¥ï¼ŒæŒæ¡äº† **LangGraph** çš„æ ¸å¿ƒèƒ½åŠ›ï¼š

  

1. **å®‰è£…ä¸å¿«é€Ÿä½“éªŒ**ï¼šåˆ›å»ºæœ€å°å›¾ã€è°ƒç”¨ LLMï¼›
    
2. **Node ä¸ Edge**ï¼šç†è§£å›¾ä¸­èŠ‚ç‚¹å’Œè¾¹çš„æœ¬è´¨ï¼›
    
3. **æ„å»ºæµç¨‹å›¾**ï¼šå¤šèŠ‚ç‚¹ä¸²è”æˆ–å¹¶è¡Œï¼›
    
4. **æ•´åˆ LLM**ï¼šè‡ªå®šä¹‰ Promptã€è°ƒå‚ï¼›
    
5. **Agent + Tools**ï¼šè®©æ¨¡å‹åœ¨å¤šæ­¥å¯¹è¯ä¸­è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼›
    
6. **å¤š Agent åä½œ**ï¼šåœ¨ä¸€ä¸ªå›¾é‡Œå¹¶è¡Œæˆ–ä¸²è”å¤šä¸ª Agentï¼›
    
7. **è°ƒè¯•ä¸å¯è§†åŒ–**ï¼šæŸ¥çœ‹èŠ‚ç‚¹è¾“å…¥è¾“å‡ºã€å¯¼å‡º.dot æ–‡ä»¶ï¼›
    
8. **ç¤ºä¾‹é¡¹ç›®ä¸è¯„ä¼°**ï¼šå°†çŸ¥è¯†åº“é—®ç­”ä¸²è”èµ·æ¥ï¼Œåšç®€å•è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
    

  

é€šè¿‡è¿™äº›å­¦ä¹ ï¼Œä½ èƒ½åœ¨ LangGraph ä¸­çµæ´»åœ°ç»„ç»‡å¯¹è¯é€»è¾‘ã€å·¥å…·è°ƒç”¨å’Œé«˜çº§æ¨ç†æµç¨‹ï¼Œä¹Ÿèƒ½è¿›è¡Œä¸€å®šç¨‹åº¦çš„è°ƒè¯•ä¸è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åç»­ä½ å¯ä»¥æ¢ç´¢æ›´å¤æ‚çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¡ä»¶åˆ†æ”¯ã€è‡ªå®šä¹‰æ‰§è¡Œè°ƒåº¦ã€å¤§å‹çŸ¥è¯†åº“æ£€ç´¢ã€UI é›†æˆç­‰ï¼Œç”šè‡³æ­å»ºçœŸå®çš„å¤šè½®å¯¹è¯åº”ç”¨ã€‚

  

**ç¥ä½ åœ¨å¤š Agent å’Œå›¾å¼å¯¹è¯ç¼–æ’çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œï¼Œç©è½¬ LangGraphï¼**

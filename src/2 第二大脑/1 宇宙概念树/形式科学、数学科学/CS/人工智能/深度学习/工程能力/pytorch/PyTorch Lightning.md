---
draw:
title: PyTorch Lightning
date created: 2025-04-12
date modified: 2025-05-12
---
## 1. `train.py`——“厨师的全套餐配方”

| 关键词                   | 通俗解释                                                                                                                                                                                 |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **PyTorch Lightning** | 把普通 PyTorch 训练流程（准备食材→下锅→出锅）封装成“高级电饭煲”。你只写“食谱”，它自动帮你开火、调火候、计时、保存成品。|
| **5 个 stage**         | 一顿正餐分前菜、主菜、甜点：1) **pretrain_ce**：先学最简单的“单一口味”（交叉熵，单标签）。2) **pretrain_bce**：再学“混合口味”（BCE，多标签）。3) **train**：真正大火慢炖，把模型参数全部煮透。4) **finetune**：最后小火勾芡，细调味。（仓库里还留了一个可选 stage，依赖伪标签，用不用随你）|
| **7 个 backbone**      | “锅具/锅底”的选择：ResNet、EfficientNet、CRNN……一共 7 种。脚本里用 `--model_name sed_v2s` 之类的参数就能换锅，不用改核心代码。|

> 换句话说，`train.py` 就是一把多档位的电饭煲：
> - 旋钮 1 选“阶段”（stage）；
> - 旋钮 2 选“锅底”（backbone）；
>     然后按 **Start**，剩下的自动帮你搞定。
>

---

## 2. `convert.py`——“成品菜打包盒”

竞赛提交时只允许**60 分钟**内跑完所有测试音频，原始 PyTorch 模型太重、下菜慢，需要“装盒速递”：

|步骤|比喻|作用|
|---|---|---|
|**ckpt → ONNX**|把“厨房里用的铁锅”换成“外卖专用一次性盒”|ONNX 是通用格式，去掉研发用的多余信息，体积变小，平台通用|
|**ONNX → OpenVINO**|贴上“闪送特快”标签|OpenVINO 会进一步把模型裁剪、量化、并行优化，让 **CPU** 都能飞快推理|
|**满足 60 min 时限**|让外卖能在平台规定时效内送到，超时就会被扣分|一段 10–60 s 音频必须在 ≤10 s 内跑完，全部测试集累计 ≤60 min|

> 所以 `convert.py` 就像：
>
> 1. **拆下** 厨房里的铁锅（`.ckpt`）；
> 2. **装进** 外卖盒（`.onnx`）；
> 3. **贴上** 加速标签（OpenVINO `.xml/.bin`）；
>     打包好后放到骑手手里（评测服务器），确保迅速送达。
>

---

### 小结一句话

- **`train.py`**：选择不同“阶段 + 锅底”，自动烹饪模型。
    
- **`convert.py`**：把烹饪好的模型压缩-加速，保证比赛评测跑得又快又稳。
    

这样就能明白它们在整个项目中的角色啦！

PyTorch Lightning是一个轻量级的PyTorch包装库，它的主要目的是简化深度学习研究和开发过程，同时保持代码的科学性和可重复性。以下是Lightning的核心功能和特点：

1. **代码组织结构化**：
    
    - 它提供了一个结构化的框架，通过LightningModule类将PyTorch代码整合成更有组织的形式
    - 帮助分离研究代码(模型逻辑)和工程代码(训练循环、GPU分配等)
2. **硬件抽象**：
    
    - 自动处理设备分配(GPU/TPU/CPU)
    - 无需手动编写设备转移代码(.to(device))
    - 支持分布式训练，包括DDP(DistributedDataParallel)、Horovod等
3. **训练功能集成**：
    
    - 内置常用的训练功能，如梯度累积、早停、模型检查点保存/加载
    - 自动化训练、验证和测试循环
    - 内置性能分析工具和内存管理
4. **兼容性**：
    
    - 与大多数PyTorch生态系统兼容
    - 可以与Weights & Biases、TensorBoard等监控工具集成
    - 支持各种优化器和学习率调度器

与原生PyTorch相比，Lightning减少了大量样板代码，同时提高了代码的可读性和可维护性。它特别适合研究环境，让研究人员可以专注于模型创新而不是训练循环实现细节。

简单来说，PyTorch Lightning做的是"让PyTorch更好用"的工作，它不是一个单独的深度学习框架，而是对PyTorch的高级抽象，旨在提高开发效率和代码质量。

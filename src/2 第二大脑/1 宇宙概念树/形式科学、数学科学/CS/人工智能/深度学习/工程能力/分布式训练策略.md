---
date created: 2025-03-24
date modified: 2025-07-10
uid: b8ccde1d-c33a-4cd9-8705-ac2733c6e532
---

ä½ å›¾ä¸­å±•ç¤ºçš„å››ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«ä»£è¡¨å‡ ç§ä¸åŒçš„ **åˆ†å¸ƒå¼è®­ç»ƒç­–ç•¥**ï¼š

---

## ğŸ“Œ ä¸€ã€ç®€è¦è¯´æ˜

|æ–‡ä»¶å|ä»£è¡¨çš„å«ä¹‰|é€‚åˆåœºæ™¯|ç‰¹ç‚¹|
|---|---|---|---|
|`ddp.yaml`|**Distributed Data Parallel** (åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œ)|æ•°æ®å¹¶è¡Œï¼Œå¤šGPUå¤šå¡çš„ç»å…¸æ–¹æ¡ˆ|æœ€ç®€å•ï¼Œé€šä¿¡å¼€é”€é€‚ä¸­|
|`fsdp.yaml`|**Fully Sharded Data Parallel** (å…¨åˆ†ç‰‡æ•°æ®å¹¶è¡Œ)|è¶…å¤§æ¨¡å‹ï¼Œå‚æ•°åˆ†ç‰‡ï¼ŒèŠ‚çœæ˜¾å­˜|PyTorchåŸç”Ÿï¼Œç±»ä¼¼äºDeepSpeed ZeRO|
|`zero2.yaml`|**DeepSpeed ZeRO Stage 2** (ZeROç¬¬äºŒé˜¶æ®µä¼˜åŒ–)|å¤§å‹æ¨¡å‹ï¼Œé™ä½æ˜¾å­˜å ç”¨|æ˜¾å­˜èŠ‚çœæ˜æ˜¾ï¼Œé€Ÿåº¦è¾ƒå¿«|
|`zero3.yaml`|**DeepSpeed ZeRO Stage 3** (ZeROç¬¬ä¸‰é˜¶æ®µä¼˜åŒ–)|æå¤§æ¨¡å‹ï¼Œæè‡´é™ä½æ˜¾å­˜å ç”¨|æœ€èŠ‚çœæ˜¾å­˜ï¼Œä½†é€šä¿¡å¼€é”€è¾ƒå¤§|

---

## ğŸ“Œ äºŒã€è¯¦ç»†è§£é‡Š

### ğŸš© **1. ddp.yaml (Distributed Data Parallel)**

- æœ€ç»å…¸çš„åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œæ–¹æ¡ˆã€‚
- æ¨¡å‹å®Œæ•´åœ°å¤åˆ¶åˆ°æ¯å¼ GPUï¼Œæ¯ä¸ªGPUè´Ÿè´£ä¸åŒçš„æ•°æ®éƒ¨åˆ†ï¼ˆæ¯å¼ å¡æ¨¡å‹å‰¯æœ¬ä¸€è‡´ï¼‰ã€‚
- è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒGPUä¹‹é—´åªåŒæ­¥æ¢¯åº¦ï¼Œä¸åˆ†ç‰‡å‚æ•°ã€‚
- **ä¼˜ç‚¹**ï¼šç®€å•ã€é€Ÿåº¦è¾ƒå¿«ï¼ˆå°å‹æ¨¡å‹ï¼‰ã€‚
- **ç¼ºç‚¹**ï¼šæ˜¾å­˜å ç”¨å¤§ï¼Œæ¨¡å‹è¶Šå¤§ï¼Œæ¯å¼ å¡ä¸Šéƒ½å¾—æ”¾å®Œæ•´æ¨¡å‹å‰¯æœ¬ã€‚

**é€‚åˆåœºæ™¯**ï¼š

- ä¸­å°å‹æ¨¡å‹ï¼ˆå‡ åƒä¸‡~å‡ åäº¿å‚æ•°ï¼‰ï¼Œå¦‚ä½ ç›®å‰çš„ Qwen 1.5B æ¨¡å‹ï¼Œæ˜¾å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼ŒDDP æ€§èƒ½æä½³ã€‚

---

### ğŸš© **2. fsdp.yaml (Fully Sharded Data Parallel)**

- PyTorch åŸç”Ÿæ”¯æŒçš„é«˜çº§åˆ†ç‰‡æ•°æ®å¹¶è¡Œç­–ç•¥ã€‚
- æ¨¡å‹å‚æ•°åˆ†ç‰‡åˆ°å¤šä¸ªGPUï¼Œæ¯ä¸ªGPUåªå­˜æ¨¡å‹ä¸€éƒ¨åˆ†å‚æ•°ã€‚
- åœ¨è®¡ç®—æ—¶åŠ¨æ€åŠ è½½å¹¶åŒæ­¥å…¶ä»–GPUä¸Šçš„å‚æ•°ç‰‡æ®µã€‚
- **ä¼˜ç‚¹**ï¼šæ˜¾å­˜å ç”¨ä½ï¼Œæ”¯æŒè®­ç»ƒæ•°åäº¿ç”šè‡³æ•°ç™¾äº¿å‚æ•°æ¨¡å‹ã€‚
- **ç¼ºç‚¹**ï¼šé€šä¿¡åŒæ­¥é¢‘ç¹ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚

**é€‚åˆåœºæ™¯**ï¼š

- è¶…å¤§æ¨¡å‹ï¼Œå¦‚æ•°åäº¿åˆ°æ•°ç™¾äº¿å‚æ•°æ¨¡å‹ï¼ˆä¾‹å¦‚70B Llamaï¼Œ30B GPTï¼‰ã€‚

---

### ğŸš© **3. zero2.yaml (DeepSpeed ZeRO Stage-2)**

- ç”±DeepSpeedæå‡ºï¼Œå‚æ•°ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆAdamä¼˜åŒ–å™¨çŠ¶æ€ï¼‰åˆ†ç‰‡ä¿å­˜ã€‚
- æ¯ä¸ªGPUåªä¿å­˜éƒ¨åˆ†ä¼˜åŒ–å™¨çŠ¶æ€å’Œæ¢¯åº¦ä¿¡æ¯ï¼Œå‚æ•°æœ¬èº«æ¯ä¸ªGPUéƒ½æœ‰å®Œæ•´å‰¯æœ¬ã€‚
- åœ¨ä¼˜åŒ–é˜¶æ®µé€šè¿‡é€šä¿¡åˆå¹¶å„ä¸ªGPUä¸Šçš„åˆ†ç‰‡ä¼˜åŒ–çŠ¶æ€ã€‚
- **ä¼˜ç‚¹**ï¼šæ˜¾å­˜èŠ‚çœæ¯”DDPæ˜æ˜¾ï¼ŒåŒæ—¶é€šä¿¡å¼€é”€ç›¸å¯¹é€‚ä¸­ã€‚
- **ç¼ºç‚¹**ï¼šä»ç„¶å­˜åœ¨éƒ¨åˆ†æ˜¾å­˜å ç”¨å‹åŠ›ï¼Œé€‚åˆä¸­å¤§å‹æ¨¡å‹ã€‚

**é€‚åˆåœºæ™¯**ï¼š

- å¤§å‹æ¨¡å‹ï¼ˆ1B~10Bï¼‰ï¼Œæ¯”å¦‚ä½ ç°åœ¨çš„ Qwen 1.5Bï¼Œzero2æ¨¡å¼éå¸¸é€‚åˆã€‚

---

### ğŸš© **4. zero3.yaml (DeepSpeed ZeRO Stage-3)**

- è¿›ä¸€æ­¥åˆ†ç‰‡å‚æ•°æœ¬èº«ï¼Œæ¯ä¸ªGPUåªä¿å­˜æ¨¡å‹ä¸€å°ç‰‡å‚æ•°ã€‚
- åŒæ—¶è¿˜åˆ†ç‰‡ä¿å­˜ä¼˜åŒ–å™¨çŠ¶æ€ã€æ¢¯åº¦çŠ¶æ€ã€‚
- æ¯æ¬¡å‰å‘ä¼ æ’­æ—¶ï¼Œéœ€è¦é€šä¿¡åŠ è½½ä¸åŒGPUä¸Šçš„å‚æ•°åˆ°æœ¬åœ°è¿›è¡Œè®¡ç®—ã€‚
- **ä¼˜ç‚¹**ï¼šæ˜¾å­˜å ç”¨æä½ï¼Œå¯ä»¥è®­ç»ƒç™¾äº¿ã€åƒäº¿ç”šè‡³ä¸‡äº¿å‚æ•°æ¨¡å‹ã€‚
- **ç¼ºç‚¹**ï¼šé¢‘ç¹é€šä¿¡å¯¼è‡´æ•´ä½“è®­ç»ƒé€Ÿåº¦é™ä½ã€‚

**é€‚åˆåœºæ™¯**ï¼š

- è¶…çº§å¤§å‹æ¨¡å‹ï¼ˆ> 10B å‚æ•°ï¼‰ï¼Œå¦‚è®­ç»ƒLlama 65Bã€175B GPT-3è¿™ç§çº§åˆ«ã€‚

---

## ğŸ“Œ ä¸‰ã€ä½ ç°åœ¨çš„æ¨¡å‹ï¼ˆQwen 1.5Bï¼‰ç”¨å“ªä¸ªåˆé€‚ï¼Ÿ

### æ¨èä¼˜å…ˆçº§

âœ… æœ€ä½³é€‰æ‹©ï¼š`zero2.yaml`  
åŸå› ï¼šä½ çš„æ¨¡å‹ï¼ˆQwen 1.5Bï¼‰å‚æ•°é‡ä¸ç®—ç‰¹åˆ«å¤§ï¼ŒZeRO-2 å·²è¶³å¤Ÿæ˜¾å­˜ä¼˜åŒ–ï¼Œä¸”é€Ÿåº¦æ›´å¿«ã€‚

ğŸ”¸ æ¬¡ä½³é€‰æ‹©ï¼š`ddp.yaml`  
å¦‚æœæ˜¾å­˜å……è¶³ï¼ŒDDP æ›´ç®€å•ï¼Œé€Ÿåº¦ç”šè‡³æ›´å¿«ã€‚

ğŸ”´ éå¿…è¦æ—¶ä¸æ¨èç”¨ï¼š

- `zero3.yaml`ï¼ˆé€šä¿¡è´Ÿæ‹…è¿‡å¤§ï¼Œé€Ÿåº¦æ…¢ï¼‰
- `fsdp.yaml`ï¼ˆPyTorchåŸç”Ÿfsdpå¯¹è¾ƒå°æ¨¡å‹æ²¡æœ‰æ˜æ˜¾ä¼˜åŠ¿ï¼‰

---

## ğŸ“Œ å››ã€ä½ çš„ä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆåšï¼Ÿ

å»ºè®®ä½ ç«‹åˆ»æ”¹ç”¨ï¼š

```shell
accelerate launch --config_file=recipes/accelerate_configs/zero2.yaml src/open_r1/sft.py \
    --model_name_or_path Qwen/Qwen2.5-1.5B-Instruct \
    --dataset_name /root/autodl-tmp/open-r1/data/OpenR1-Math-220k \
    --learning_rate 1.0e-5 \
    --num_train_epochs 1 \
    --packing \
    --max_seq_length 2048 \
    --per_device_train_batch_size 8 \
    --gradient_accumulation_steps 2 \
    --gradient_checkpointing \
    --fp16 \
    --output_dir data/Qwen2.5-1.5B-Open-R1-Distill \
    --save_steps 20000 \
    --eval_strategy no
```

- è°ƒæ•´ä¸º **ZeRO-2** æ¨¡å¼åï¼ŒGPU åˆ©ç”¨ç‡ä¼šæ›´é«˜ï¼Œé€Ÿåº¦ä¼šæ˜æ˜¾æå‡ã€‚

---

âœ… **æ€»ç»“ï¼ˆæœ€ç»ˆé€‰æ‹©å»ºè®®ï¼‰ï¼š**

- å½“å‰ä½ çš„æ¨¡å‹è§„æ¨¡é€‚åˆç”¨ **DeepSpeed ZeRO-2** (`zero2.yaml`)ã€‚
- `DDP`å¯å¤‡ç”¨ï¼Œä½†æ˜¾å­˜å¿…é¡»å……è£•ã€‚
- å°½é‡é¿å… ZeRO-3ï¼ˆé€Ÿåº¦æ…¢ï¼‰ã€fsdpï¼ˆå¯¹å½“å‰æ¨¡å‹è§„æ¨¡æ— å¿…è¦ï¼‰ã€‚

ä½ å¯ä»¥ç«‹åˆ»ä½¿ç”¨æ¨èçš„ **zero2.yaml** è¿›è¡Œå®éªŒï¼Œæ˜¾è‘—æé«˜è®­ç»ƒé€Ÿåº¦ã€‚
